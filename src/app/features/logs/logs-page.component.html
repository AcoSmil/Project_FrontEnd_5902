<div class="page-title">Playback logs</div>
<div class="muted">Create logs (interesting beyond CRUD: joined lookup + filtering by multiple fields).</div>

<div class="toolbar">
  <input class="input" placeholder="Search logs…" [(ngModel)]="q" />
  <button class="btn" (click)="loadAll()">Reload all</button>
  <button class="btn" (click)="newLog()">New log</button>
</div>

<div class="card">
  <h3 style="margin:0 0 10px;">Create playback log</h3>

  <div class="grid" style="grid-template-columns: repeat(3, minmax(0,1fr));">
    <input class="input" placeholder="playbackId" [(ngModel)]="form.playbackId" />

    <select class="select" [(ngModel)]="form.userId">
      <option value="">Select user…</option>
      <option *ngFor="let u of users" [value]="u.userId">{{ u.name }} ({{ u.userId }})</option>
    </select>

    <select class="select" [(ngModel)]="form.exhibitId">
      <option value="">Select exhibit…</option>
      <option *ngFor="let e of exhibits" [value]="e.exhibitId">{{ e.name }} ({{ e.exhibitId }})</option>
    </select>
  </div>

  <div class="toolbar" style="margin-top:12px;">
    <select class="select" [(ngModel)]="form.language">
      <option value="EN">EN</option>
      <option value="MK">MK</option>
    </select>
    <button class="btn" (click)="create()">Create</button>
    <span class="badge">timestamp: {{ form.timestamp }}</span>
  </div>

  <div class="error" *ngIf="error">{{ error }}</div>
</div>

<table class="table" style="margin-top:14px;">
  <thead>
    <tr>
      <th>Playback ID</th>
      <th>User</th>
      <th>Exhibit</th>
      <th>Language</th>
      <th>Timestamp</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    <tr class="row" *ngFor="let l of filtered">
      <td><span class="badge">{{ l.playbackId }}</span></td>
      <td>{{ userName(l.userId) || '(missing user)' }}</td>
      <td>{{ exhibitName(l.exhibitId) || '(missing exhibit)' }}</td>
      <td><span class="badge">{{ l.language }}</span></td>
      <td class="muted">{{ l.timestamp }}</td>
      <td>
        <button class="btn danger" (click)="remove(l.playbackId)">Delete</button>
      </td>
    </tr>
  </tbody>
</table>
